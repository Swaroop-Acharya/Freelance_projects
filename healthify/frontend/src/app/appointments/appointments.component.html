<div class="appointments-container">
  <div class="header">
    <h1>Appointments</h1>
    <button class="add-appointment-btn" (click)="openAddModal()">
      <i class="fas fa-plus"></i> Add Appointment
    </button>
  </div>

  <!-- Add Appointment Modal -->
  <div *ngIf="showAddModal" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h2>Add New Appointment</h2>
        <button class="close-btn" (click)="closeAddModal()">&times;</button>
      </div>
      <div class="modal-body">
      <form (ngSubmit)="addAppointment()" #appointmentForm="ngForm">
          <div class="form-group">
            <label for="bookingId">Booking ID*</label>
            <input type="text" id="bookingId" name="bookingId" [(ngModel)]="newAppointment.bookingId" required>
          </div>

          <div class="form-group">
            <label for="patientName">Patient Name*</label>
            <input type="text" id="patientName" name="patientName" [(ngModel)]="newAppointment.patientName" required>
          </div>

          <div class="form-group">
            <label for="age">Age*</label>
            <input type="number" id="age" name="age" [(ngModel)]="newAppointment.age" required>
          </div>

          <div class="form-group">
            <label for="phoneNumber">Phone Number*</label>
            <input type="tel" id="phoneNumber" name="phoneNumber" [(ngModel)]="newAppointment.phoneNumber" required>
          </div>

          <div class="form-group">
            <label for="appointmentTime">Appointment Date & Time*</label>
            <input type="datetime-local" id="appointmentTime" name="appointmentTime" [(ngModel)]="newAppointment.appointmentTime" required>
          </div>

          <div class="form-group">
            <label for="appointmentType">Appointment Type*</label>
            <select id="appointmentType" name="appointmentType" [(ngModel)]="newAppointment.appointmentType" required>
              <option *ngFor="let type of appointmentTypes" [value]="type">{{type}}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="doctorId">Doctor*</label>
            <select id="doctorId" name="doctorId" [(ngModel)]="newAppointment.doctorId" required>
              <option [ngValue]="null">-- Select a Doctor --</option>
              <option *ngFor="let doctor of doctors" [ngValue]="doctor.id">
                Dr. {{ doctor.fullName || doctor.username }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="duration">Duration</label>
            <select id="duration" name="duration" [(ngModel)]="newAppointment.duration" required>
              <option value="10 min">10 min</option>
              <option value="15 min">15 min</option>
              <option value="20 min">20 min</option>
              <option value="30 min">30 min</option>
              <option value="45 min">45 min</option>
              <option value="60 min">60 min</option>
            </select>
          </div>

          <div class="form-group">
            <label for="purpose">Purpose*</label>
            <textarea id="purpose" name="purpose" [(ngModel)]="newAppointment.purpose" required style="border: 1px solid black;"></textarea>
          </div>

          <div *ngIf="error" class="error-message" role="alert">
            {{error}}
        </div>

        <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Create Appointment</button>
            <button type="button" class="btn btn-secondary" (click)="closeAddModal()">Cancel</button>
        </div>
      </form>
      </div>
    </div>
  </div>

  <!-- Edit Appointment Modal -->
  <div class="modal-backdrop" *ngIf="showEditModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Edit Appointment</h2>
        <button class="close-btn" (click)="closeEditModal()">&times;</button>
      </div>
      <form (ngSubmit)="updateAppointment()" #editForm="ngForm" *ngIf="selectedAppointment">
        <div class="modal-body">
          <div class="form-group">
            <label>Booking ID</label>
            <input type="text" [(ngModel)]="selectedAppointment.bookingId" name="bookingId" required />
          </div>
          <div class="form-group">
            <label>Patient Name</label>
            <input type="text" [(ngModel)]="selectedAppointment.patientName" name="patientName" required />
          </div>
          <div class="form-group">
            <label>Date</label>
            <input type="date" [(ngModel)]="selectedAppointment.date" name="date" required />
          </div>
          <div class="form-group">
            <label>Time</label>
            <input type="time" [(ngModel)]="selectedAppointment.time" name="time" required />
          </div>
          <div class="form-group">
            <label>Purpose</label>
            <select [(ngModel)]="selectedAppointment.purpose" name="purpose" required style="border: 1px solid black;">
              <option value="Consultation">Consultation</option>
              <option value="Follow up">Follow up</option>
            </select>
          </div>
          <div class="form-group">
            <label>Duration</label>
            <select [(ngModel)]="selectedAppointment.duration" name="duration" required>
              <option value="10 min">10 min</option>
              <option value="15 min">15 min</option>
              <option value="20 min">20 min</option>
              <option value="30 min">30 min</option>
              <option value="45 min">45 min</option>
              <option value="60 min">60 min</option>
            </select>
          </div>
          <div class="form-group">
            <label>Doctor</label>
            <select [(ngModel)]="selectedAppointment.doctor" name="doctor" required>
              <option *ngFor="let doctor of doctors" [value]="doctor.id">
                Dr. {{ doctor.fullName || doctor.username }}
              </option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-backdrop" *ngIf="showDeleteModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Delete Appointment</h2>
        <button class="close-btn" (click)="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the appointment for {{ appointmentToDelete?.patientName }}?</p>
        <p>Booking ID: {{ appointmentToDelete?.bookingId }}</p>
        <p>Date: {{ appointmentToDelete?.date }} at {{ appointmentToDelete?.time }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="confirmDelete()" style="background-color: #dc2626;">Delete</button>
      </div>
    </div>
  </div>

  <div class="table-controls">
    <div class="entries-info">
      Show
      <select [(ngModel)]="itemsPerPage">
        <option [value]="10">10</option>
        <option [value]="25">25</option>
        <option [value]="50">50</option>
        <option [value]="100">100</option>
      </select>
      entries
    </div>
    <div class="search-box">
      <label for="search">Search:</label>
      <input type="text" id="search" [(ngModel)]="searchText" placeholder="Search...">
    </div>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Sl No</th>
          <th>Patient Name</th>
          <th>Date</th>
          <th>Time</th>
          <th>Purpose</th>
          <th>Duration</th>
          <th>Doctor</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let appointment of paginatedAppointments; let i = index">
          <td>{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
          <td>{{ appointment.patientName }}</td>
          <td>{{ appointment.date }}</td>
          <td>{{ appointment.time }}</td>
          <td>{{ appointment.purpose }}</td>
          <td>{{ appointment.duration }}</td>
          <td>{{ appointment.doctor }}</td>
          <td class="actions">
            <button class="action-btn edit" (click)="editAppointment(appointment)">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete" (click)="deleteAppointment(appointment)">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="table-footer">
    <div class="showing-entries">
      Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to 
      {{ Math.min(currentPage * itemsPerPage, filteredAppointments.length) }} 
      of {{ filteredAppointments.length }} entries
    </div>
    <div class="pagination">
      <button [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
        Previous
      </button>
      <button *ngFor="let page of [].constructor(totalPages); let i = index"
              [class.active]="currentPage === i + 1"
              (click)="onPageChange(i + 1)">
        {{ i + 1 }}
      </button>
      <button [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">
        Next
      </button>
    </div>
  </div>
</div> 